<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Measures of Dispersion - Quantitative Research Methods</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #06b6d4;
            --accent: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --purple: #a855f7;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --card-bg-light: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body { height: 100vh; overflow: hidden; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
        }
        
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 12px 16px;
        }
        
        /* Header & Navigation */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0 12px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 12px;
            flex-shrink: 0;
        }
        
        .header-left h1 {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--purple) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-left p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .nav {
            display: flex;
            gap: 8px;
        }
        
        .nav a {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .nav a:hover {
            background: var(--card-bg);
            color: var(--text);
        }
        
        .nav a.active {
            background: var(--purple);
            color: white;
            border-color: var(--purple);
        }
        
        /* Main Grid */
        .dashboard {
            display: grid;
            grid-template-columns: 260px 1fr 320px;
            gap: 12px;
            flex: 1;
            min-height: 0;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }
        
        /* Left Column */
        .left-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
        }
        
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        input[type="number"] {
            flex: 1;
            background: var(--card-bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary { background: var(--purple); color: white; }
        .btn-primary:hover { background: #9333ea; }
        .btn-secondary { background: var(--card-bg-light); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--border); }
        .btn-danger { background: rgba(244, 63, 94, 0.2); color: var(--accent); }
        .btn-danger:hover { background: var(--accent); color: white; }
        .btn-small { padding: 8px 12px; font-size: 0.8rem; }
        
        .sample-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            gap: 8px;
        }
        
        .stat-card {
            background: var(--card-bg-light);
            border-radius: 10px;
            padding: 12px;
            border-left: 3px solid;
        }
        
        .stat-card.range { border-left-color: var(--warning); }
        .stat-card.variance { border-left-color: var(--purple); }
        .stat-card.sd { border-left-color: var(--secondary); }
        .stat-card.iqr { border-left-color: var(--success); }
        
        .stat-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .stat-card.range .stat-value { color: var(--warning); }
        .stat-card.variance .stat-value { color: var(--purple); }
        .stat-card.sd .stat-value { color: var(--secondary); }
        .stat-card.iqr .stat-value { color: var(--success); }
        
        .stat-formula {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
            font-family: monospace;
        }
        
        .data-section {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .data-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .data-tag {
            background: var(--card-bg-light);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.8rem;
            border: 1px solid var(--border);
        }
        
        .empty-state {
            color: var(--text-muted);
            text-align: center;
            padding: 30px 10px;
        }
        
        .count-badge {
            background: var(--purple);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        /* Center & Right */
        .center-col, .right-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
        }
        
        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        
        .chart-container {
            position: relative;
            height: 100%;
            width: 100%;
        }
        
        /* Interpretation Box */
        .interpret-box {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid var(--purple);
            border-radius: 10px;
            padding: 12px;
        }
        
        .interpret-box h4 {
            color: var(--purple);
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
        
        .interpret-box p {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.5;
        }
        
        .variability-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
        }
        
        .indicator-bar {
            flex: 1;
            height: 8px;
            background: var(--card-bg-light);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .indicator-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .indicator-fill.low { background: var(--success); width: 20%; }
        .indicator-fill.medium { background: var(--warning); width: 50%; }
        .indicator-fill.high { background: var(--accent); width: 80%; }
        
        .indicator-label {
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 60px;
        }
        
        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .comparison-table th {
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.65rem;
            text-transform: uppercase;
        }
        
        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .info-card {
            background: var(--card-bg-light);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid;
        }
        
        .info-card.range { border-left-color: var(--warning); }
        .info-card.sd { border-left-color: var(--secondary); }
        .info-card.iqr { border-left-color: var(--success); }
        .info-card.var { border-left-color: var(--purple); }
        
        .info-card h4 {
            font-size: 0.75rem;
            margin-bottom: 4px;
        }
        
        .info-card p {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .formula {
            background: var(--bg);
            padding: 6px 8px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.7rem;
            margin-top: 6px;
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üìä Measures of Dispersion</h1>
                <p>Understanding Variability in Data | Quantitative Research Methods</p>
            </div>
            <nav class="nav">
                <a href="index.html">Central Tendency</a>
                <a href="dispersion.html" class="active">Dispersion</a>
                <a href="distribution.html">Distribution</a>
                <a href="sampling.html">Sampling</a>
                <a href="correlation.html">Correlation</a>
            </nav>
        </header>
        
        <div class="dashboard">
            <!-- Left Column -->
            <div class="left-col">
                <div class="card" style="flex-shrink: 0;">
                    <div class="card-title">üéØ Data Input</div>
                    <div class="input-group">
                        <input type="number" id="heightInput" placeholder="Height (cm)" min="50" max="300" step="0.1">
                        <button class="btn btn-primary" onclick="addDataPoint()">Add</button>
                    </div>
                    <div class="sample-buttons">
                        <button class="btn btn-secondary btn-small" onclick="addRandomSample(5)">+5 üé≤</button>
                        <button class="btn btn-secondary btn-small" onclick="addRandomSample(10)">+10 üé≤</button>
                        <button class="btn btn-secondary btn-small" onclick="addRandomSample(15)">+15 üé≤</button>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="clearAllData()" style="width: 100%;">Clear All</button>
                </div>
                
                <div class="card" style="flex-shrink: 0;">
                    <div class="card-title">üìà Measures of Spread</div>
                    <div class="stats-grid">
                        <div class="stat-card range">
                            <div class="stat-label">Range (Max - Min)</div>
                            <div class="stat-value" id="rangeValue">-</div>
                            <div class="stat-formula">R = max - min</div>
                        </div>
                        <div class="stat-card variance">
                            <div class="stat-label">Variance (œÉ¬≤)</div>
                            <div class="stat-value" id="varianceValue">-</div>
                            <div class="stat-formula">œÉ¬≤ = Œ£(x-xÃÑ)¬≤/n</div>
                        </div>
                        <div class="stat-card sd">
                            <div class="stat-label">Standard Deviation (œÉ)</div>
                            <div class="stat-value" id="sdValue">-</div>
                            <div class="stat-formula">œÉ = ‚àövariance</div>
                        </div>
                        <div class="stat-card iqr">
                            <div class="stat-label">Interquartile Range (IQR)</div>
                            <div class="stat-value" id="iqrValue">-</div>
                            <div class="stat-formula">IQR = Q3 - Q1</div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="flex: 1; min-height: 0;">
                    <div class="card-title">üìã Data Points <span class="count-badge" id="countValue">0</span></div>
                    <div class="data-section" id="dataList">
                        <div class="empty-state">
                            <div style="font-size: 2rem; opacity: 0.5; margin-bottom: 8px;">üì≠</div>
                            <p style="font-size: 0.85rem;">Add data to see variability measures</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Column -->
            <div class="center-col">
                <!-- Box Plot -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">üì¶ Box Plot (Five-Number Summary)</div>
                    <div class="chart-wrapper">
                        <div class="chart-container">
                            <canvas id="boxplotChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Standard Deviation Visualization -->
                <div class="card" style="flex: 1;">
                    <div class="card-title">üìä Standard Deviation Visualization</div>
                    <div class="chart-wrapper">
                        <div class="chart-container">
                            <canvas id="sdChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="right-col">
                <div class="card interpret-box" style="flex-shrink: 0;">
                    <h4>ü§î Interpreting Variability</h4>
                    <p>How spread out is your data?</p>
                    <div class="variability-indicator">
                        <span class="indicator-label">Spread:</span>
                        <div class="indicator-bar">
                            <div class="indicator-fill" id="variabilityBar"></div>
                        </div>
                        <span class="indicator-label" id="variabilityText">-</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.75rem; color: var(--text-muted);">
                        <div>‚Ä¢ <strong>Low SD (&lt;5):</strong> Data clustered tightly</div>
                        <div>‚Ä¢ <strong>Medium SD (5-15):</strong> Moderate spread</div>
                        <div>‚Ä¢ <strong>High SD (&gt;15):</strong> Data widely dispersed</div>
                    </div>
                </div>
                
                <div class="card" style="flex: 1;">
                    <div class="card-title">üìè Quartile Breakdown</div>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Measure</th>
                                <th>Value</th>
                                <th>Percentile</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Minimum</strong></td>
                                <td id="minValue">-</td>
                                <td>0%</td>
                            </tr>
                            <tr>
                                <td><strong>Q1 (25th)</strong></td>
                                <td id="q1Value">-</td>
                                <td>25%</td>
                            </tr>
                            <tr>
                                <td><strong>Median (Q2)</strong></td>
                                <td id="medianValue">-</td>
                                <td>50%</td>
                            </tr>
                            <tr>
                                <td><strong>Q3 (75th)</strong></td>
                                <td id="q3Value">-</td>
                                <td>75%</td>
                            </tr>
                            <tr>
                                <td><strong>Maximum</strong></td>
                                <td id="maxValue">-</td>
                                <td>100%</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 10px; padding: 10px; background: var(--card-bg-light); border-radius: 8px; font-size: 0.75rem;">
                        <strong style="color: var(--success);">IQR = Q3 - Q1</strong>
                        <p style="color: var(--text-muted); margin-top: 4px;">Contains the middle 50% of data. Robust to outliers!</p>
                    </div>
                </div>
                
                <div class="card" style="flex-shrink: 0;">
                    <div class="card-title">üìö Dispersion Formulas</div>
                    <div class="info-grid">
                        <div class="info-card range">
                            <h4>üü° Range</h4>
                            <p>Simplest measure. Sensitive to outliers.</p>
                            <div class="formula">R = max - min</div>
                        </div>
                        <div class="info-card sd">
                            <h4>üîµ Std Dev</h4>
                            <p>Average distance from mean. Most common.</p>
                            <div class="formula">œÉ = ‚àö(Œ£(x-xÃÑ)¬≤/n)</div>
                        </div>
                        <div class="info-card iqr">
                            <h4>üü¢ IQR</h4>
                            <p>Range of middle 50%. Robust to outliers.</p>
                            <div class="formula">IQR = Q3 - Q1</div>
                        </div>
                        <div class="info-card var">
                            <h4>üü£ Variance</h4>
                            <p>Squared SD. Used in calculations.</p>
                            <div class="formula">œÉ¬≤ = Œ£(x-xÃÑ)¬≤/n</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dataPoints = [];
        let boxplotChart = null;
        let sdChart = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('heightInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addDataPoint();
            });
            updateDisplay();
        });
        
        function addDataPoint() {
            const input = document.getElementById('heightInput');
            const value = parseFloat(input.value);
            if (isNaN(value) || value < 50 || value > 300) {
                alert('Please enter a valid height between 50 and 300 cm');
                return;
            }
            dataPoints.push(value);
            input.value = '';
            input.focus();
            updateDisplay();
        }
        
        function addRandomSample(n) {
            for (let i = 0; i < n; i++) {
                dataPoints.push(Math.round((randomNormal(170, 10) + Number.EPSILON) * 10) / 10);
            }
            updateDisplay();
        }
        
        function randomNormal(mean, std) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return mean + std * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }
        
        function removeDataPoint(index) {
            dataPoints.splice(index, 1);
            updateDisplay();
        }
        
        function clearAllData() {
            if (dataPoints.length === 0) return;
            if (confirm('Clear all data?')) {
                dataPoints = [];
                updateDisplay();
            }
        }
        
        function calculateMean(data) {
            return data.reduce((a, b) => a + b, 0) / data.length;
        }
        
        function calculateQuartiles(data) {
            if (data.length === 0) return { q1: null, median: null, q3: null };
            const sorted = [...data].sort((a, b) => a - b);
            const n = sorted.length;
            
            const getPercentile = (p) => {
                const index = (p / 100) * (n - 1);
                const lower = Math.floor(index);
                const upper = Math.ceil(index);
                const weight = index - lower;
                return sorted[lower] * (1 - weight) + sorted[upper] * weight;
            };
            
            return {
                min: sorted[0],
                q1: getPercentile(25),
                median: getPercentile(50),
                q3: getPercentile(75),
                max: sorted[n - 1]
            };
        }
        
        function calculateStdDev(data) {
            if (data.length < 2) return 0;
            const mean = calculateMean(data);
            const variance = data.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / data.length;
            return Math.sqrt(variance);
        }
        
        function calculateVariance(data) {
            if (data.length < 2) return 0;
            const mean = calculateMean(data);
            return data.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / data.length;
        }
        
        function updateDisplay() {
            updateStats();
            updateDataList();
            updateBoxplot();
            updateSDChart();
            updateVariabilityIndicator();
        }
        
        function updateStats() {
            if (dataPoints.length === 0) {
                document.getElementById('rangeValue').textContent = '-';
                document.getElementById('varianceValue').textContent = '-';
                document.getElementById('sdValue').textContent = '-';
                document.getElementById('iqrValue').textContent = '-';
                document.getElementById('minValue').textContent = '-';
                document.getElementById('q1Value').textContent = '-';
                document.getElementById('medianValue').textContent = '-';
                document.getElementById('q3Value').textContent = '-';
                document.getElementById('maxValue').textContent = '-';
                document.getElementById('countValue').textContent = '0';
                return;
            }
            
            const sorted = [...dataPoints].sort((a, b) => a - b);
            const min = sorted[0];
            const max = sorted[sorted.length - 1];
            const range = max - min;
            const variance = calculateVariance(dataPoints);
            const sd = calculateStdDev(dataPoints);
            const quartiles = calculateQuartiles(dataPoints);
            const iqr = quartiles.q3 - quartiles.q1;
            
            document.getElementById('rangeValue').textContent = range.toFixed(1);
            document.getElementById('varianceValue').textContent = variance.toFixed(1);
            document.getElementById('sdValue').textContent = sd.toFixed(1);
            document.getElementById('iqrValue').textContent = iqr.toFixed(1);
            document.getElementById('minValue').textContent = min.toFixed(1);
            document.getElementById('q1Value').textContent = quartiles.q1.toFixed(1);
            document.getElementById('medianValue').textContent = quartiles.median.toFixed(1);
            document.getElementById('q3Value').textContent = quartiles.q3.toFixed(1);
            document.getElementById('maxValue').textContent = max.toFixed(1);
            document.getElementById('countValue').textContent = dataPoints.length;
        }
        
        function updateDataList() {
            const list = document.getElementById('dataList');
            if (dataPoints.length === 0) {
                list.innerHTML = `<div class="empty-state"><div style="font-size: 2rem; opacity: 0.5; margin-bottom: 8px;">üì≠</div><p>Add data to see variability measures</p></div>`;
                return;
            }
            list.innerHTML = '<div class="data-tags">' + 
                dataPoints.map((val, idx) => `<span class="data-tag">${val.toFixed(1)}<span style="cursor:pointer;color:var(--accent);margin-left:6px;" onclick="removeDataPoint(${idx})">√ó</span></span>`).join('') + 
                '</div>';
        }
        
        function updateVariabilityIndicator() {
            const sd = calculateStdDev(dataPoints);
            const bar = document.getElementById('variabilityBar');
            const text = document.getElementById('variabilityText');
            
            if (dataPoints.length < 2) {
                bar.className = 'indicator-fill';
                bar.style.width = '0%';
                text.textContent = '-';
                return;
            }
            
            if (sd < 5) {
                bar.className = 'indicator-fill low';
                text.textContent = 'Low';
                text.style.color = 'var(--success)';
            } else if (sd < 15) {
                bar.className = 'indicator-fill medium';
                text.textContent = 'Medium';
                text.style.color = 'var(--warning)';
            } else {
                bar.className = 'indicator-fill high';
                text.textContent = 'High';
                text.style.color = 'var(--accent)';
            }
        }
        
        function updateBoxplot() {
            const ctx = document.getElementById('boxplotChart').getContext('2d');
            if (boxplotChart) boxplotChart.destroy();
            
            if (dataPoints.length === 0) {
                boxplotChart = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: ['No Data'], datasets: [] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                return;
            }
            
            const q = calculateQuartiles(dataPoints);
            
            // Create box plot using bar chart
            boxplotChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Height Distribution'],
                    datasets: [
                        {
                            label: 'Min to Q1',
                            data: [q.q1 - q.min],
                            backgroundColor: 'rgba(148, 163, 184, 0.5)',
                            borderColor: '#94a3b8',
                            borderWidth: 1,
                            base: q.min
                        },
                        {
                            label: 'IQR (Q1-Q3)',
                            data: [q.q3 - q.q1],
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            base: q.q1
                        },
                        {
                            label: 'Q3 to Max',
                            data: [q.max - q.q3],
                            backgroundColor: 'rgba(148, 163, 184, 0.5)',
                            borderColor: '#94a3b8',
                            borderWidth: 1,
                            base: q.q3
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toFixed(1);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        function updateSDChart() {
            const ctx = document.getElementById('sdChart').getContext('2d');
            if (sdChart) sdChart.destroy();
            
            if (dataPoints.length === 0) {
                sdChart = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: [], datasets: [] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                return;
            }
            
            const mean = calculateMean(dataPoints);
            const sd = calculateStdDev(dataPoints);
            
            // Create normal distribution curve
            const labels = [];
            const data = [];
            const meanLine = [];
            const sd1Line = [];
            const sd2Line = [];
            
            for (let x = mean - 3 * sd; x <= mean + 3 * sd; x += sd / 10) {
                labels.push(x.toFixed(1));
                const y = (1 / (sd * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mean) / sd, 2));
                data.push(y);
                meanLine.push(x >= mean - 2 && x <= mean + 2 ? y : null);
            }
            
            sdChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Distribution',
                            data: data,
                            borderColor: 'rgba(168, 85, 247, 0.8)',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: mean,
                                    xMax: mean,
                                    borderColor: '#6366f1',
                                    borderWidth: 2,
                                    label: { content: 'Mean', enabled: true }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8', maxTicksLimit: 8 }
                        },
                        y: {
                            display: false
                        }
                    }
                },
                plugins: [{
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const xAxis = chart.scales.x;
                        const chartArea = chart.chartArea;
                        
                        // Draw SD lines
                        const drawSDLine = (val, color, label) => {
                            const idx = labels.findIndex(l => Math.abs(parseFloat(l) - val) < 0.5);
                            if (idx >= 0) {
                                const x = xAxis.getPixelForValue(idx);
                                ctx.save();
                                ctx.beginPath();
                                ctx.moveTo(x, chartArea.top);
                                ctx.lineTo(x, chartArea.bottom);
                                ctx.strokeStyle = color;
                                ctx.lineWidth = 2;
                                ctx.setLineDash([5, 5]);
                                ctx.stroke();
                                ctx.fillStyle = color;
                                ctx.font = 'bold 10px Inter';
                                ctx.fillText(label, x - 15, chartArea.bottom - 10);
                                ctx.restore();
                            }
                        };
                        
                        drawSDLine(mean - sd, 'rgba(6, 182, 212, 0.8)', '-1œÉ');
                        drawSDLine(mean + sd, 'rgba(6, 182, 212, 0.8)', '+1œÉ');
                        drawSDLine(mean - 2*sd, 'rgba(244, 63, 94, 0.5)', '-2œÉ');
                        drawSDLine(mean + 2*sd, 'rgba(244, 63, 94, 0.5)', '+2œÉ');
                    }
                }]
            });
        }
    </script>
</body>
</html>
