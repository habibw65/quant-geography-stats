<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correlation & Regression - Quantitative Research Methods</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #06b6d4;
            --accent: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --teal: #14b8a6;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --card-bg-light: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100vh; overflow: hidden; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.4;
        }
        
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 12px 16px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0 12px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 12px;
            flex-shrink: 0;
        }
        
        .header-left h1 {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--teal) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-left p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .nav {
            display: flex;
            gap: 8px;
        }
        
        .nav a {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }
        
        .nav a:hover {
            background: var(--card-bg);
            color: var(--text);
        }
        
        .nav a.active {
            background: var(--teal);
            color: white;
            border-color: var(--teal);
        }
        
        /* Info Panel */
        .info-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: all 0.2s;
        }
        
        .info-btn:hover {
            background: var(--card-bg);
            color: var(--text);
        }
        
        .info-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: var(--card-bg);
            border-left: 1px solid var(--border);
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
        }
        
        .info-panel.open {
            right: 0;
        }
        
        .info-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .info-panel-header h2 {
            font-size: 1.2rem;
            color: var(--teal);
        }
        
        .close-panel {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .close-panel:hover {
            color: var(--text);
        }
        
        .info-section {
            margin-bottom: 25px;
        }
        
        .info-section h3 {
            font-size: 1rem;
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-section p {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .info-section ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-section li {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        
        .info-section li::before {
            content: "‚Ä¢";
            color: var(--teal);
            position: absolute;
            left: 5px;
        }
        
        .formula-box {
            background: var(--bg);
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--text);
            margin: 10px 0;
            border-left: 3px solid var(--teal);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            gap: 12px;
            flex: 1;
            min-height: 0;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .left-col, .center-col, .right-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
        }
        
        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        input[type="number"] {
            flex: 1;
            background: var(--card-bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .btn {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary { background: var(--teal); color: white; }
        .btn-primary:hover { background: #0d9488; }
        .btn-secondary { background: var(--card-bg-light); color: var(--text); border: 1px solid var(--border); }
        .btn-danger { background: rgba(244, 63, 94, 0.2); color: var(--accent); }
        .btn-danger:hover { background: var(--accent); color: white; }
        .btn-small { padding: 8px 12px; font-size: 0.8rem; }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .data-table {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .data-table th, .data-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table th {
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            background: var(--card-bg);
        }
        
        .data-table tr:hover {
            background: var(--card-bg-light);
        }
        
        .remove-btn {
            cursor: pointer;
            color: var(--accent);
            font-weight: bold;
        }
        
        .empty-state {
            color: var(--text-muted);
            text-align: center;
            padding: 40px 10px;
        }
        
        .count-badge {
            background: var(--teal);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        
        .chart-container {
            position: relative;
            height: 100%;
            width: 100%;
        }
        
        /* Correlation Display */
        .correlation-display {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid var(--teal);
            border-radius: 10px;
            padding: 14px;
        }
        
        .r-value {
            text-align: center;
            margin-bottom: 12px;
        }
        
        .r-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--teal);
        }
        
        .r-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .r-strength {
            text-align: center;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .r-strength h4 {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .r-strength p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Regression Equation */
        .regression-box {
            background: var(--card-bg-light);
            border-radius: 10px;
            padding: 14px;
            margin-top: 8px;
        }
        
        .regression-box h4 {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .equation {
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
            padding: 10px;
            background: var(--bg);
            border-radius: 8px;
            color: var(--teal);
        }
        
        .regression-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .reg-stat {
            background: var(--bg);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }
        
        .reg-stat .label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .reg-stat .value {
            font-weight: 700;
            color: var(--teal);
        }
        
        /* Interpretation */
        .interpret-box {
            background: var(--card-bg-light);
            border-radius: 10px;
            padding: 14px;
            flex: 1;
        }
        
        .interpret-box h4 {
            font-size: 0.8rem;
            color: var(--teal);
            margin-bottom: 10px;
        }
        
        .correlation-scale {
            margin-top: 10px;
        }
        
        .scale-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.75rem;
        }
        
        .scale-bar {
            flex: 1;
            height: 8px;
            background: var(--card-bg);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .scale-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .scale-fill.very-strong { background: var(--success); width: 95%; }
        .scale-fill.strong { background: var(--teal); width: 75%; }
        .scale-fill.moderate { background: var(--warning); width: 50%; }
        .scale-fill.weak { background: var(--accent); width: 25%; }
        
        /* Info cards */
        .info-grid {
            display: grid;
            gap: 10px;
        }
        
        .info-card {
            background: var(--card-bg-light);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid var(--teal);
        }
        
        .info-card h4 {
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: var(--teal);
        }
        
        .info-card p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--card-bg); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üîó Correlation & Regression</h1>
                <p>Exploring Relationships Between Variables | Height vs Weight Example</p>
            </div>
            <nav class="nav">
                <a href="index.html">Central Tendency</a>
                <a href="dispersion.html">Dispersion</a>
                <a href="distribution.html">Distribution</a>
                <a href="sampling.html">Sampling</a>
                <a href="correlation.html" class="active">Correlation</a>
                <button class="info-btn" onclick="toggleInfoPanel()">‚ÑπÔ∏è Learn More</button>
            </nav>
        </header>
        
        <div class="dashboard">
            <!-- Left Column -->
            <div class="left-col">
                <div class="card" style="flex-shrink: 0;">
                    <div class="card-title">üéØ Data Input</div>
                    <div class="input-row">
                        <input type="number" id="heightInput" placeholder="Height (cm)" min="50" max="250" step="0.1">
                        <input type="number" id="weightInput" placeholder="Weight (kg)" min="20" max="200" step="0.1">
                    </div>
                    <button class="btn btn-primary" onclick="addDataPoint()" style="width: 100%; margin-bottom: 10px;">Add Data Point</button>
                    
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px;">Generate sample data:</div>
                    <div class="preset-buttons">
                        <button class="btn btn-secondary btn-small" onclick="generateData(10, 'strong')">Strong +</button>
                        <button class="btn btn-secondary btn-small" onclick="generateData(10, 'weak')">Weak +</button>
                        <button class="btn btn-secondary btn-small" onclick="generateData(10, 'negative')">Negative</button>
                        <button class="btn btn-secondary btn-small" onclick="generateData(10, 'none')">No Corr</button>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="clearAllData()" style="width: 100%;">Clear All</button>
                </div>
                
                <div class="card" style="flex: 1; min-height: 0;">
                    <div class="card-title">üìã Data Table <span class="count-badge" id="countValue">0</span></div>
                    <div class="data-table" id="dataTable">
                        <div class="empty-state">
                            <div style="font-size: 2rem; opacity: 0.5; margin-bottom: 8px;">üì≠</div>
                            <p>Add height and weight pairs</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Column -->
            <div class="center-col">
                <div class="card" style="flex: 1.2;">
                    <div class="card-title">üìä Scatter Plot with Regression Line</div>
                    <div class="chart-wrapper">
                        <div class="chart-container">
                            <canvas id="scatterChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="flex: 0.8;">
                    <div class="card-title">üìà Residual Plot</div>
                    <div class="chart-wrapper">
                        <div class="chart-container">
                            <canvas id="residualChart"></canvas>
                        </div>
                    </div>
                    <div style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                        Random scatter = good fit | Pattern = relationship not captured
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="right-col">
                <div class="card correlation-display" style="flex-shrink: 0;">
                    <div class="card-title">üîó Pearson Correlation</div>
                    <div class="r-value">
                        <div class="r-number" id="rValue">-</div>
                        <div class="r-label">Correlation Coefficient (r)</div>
                    </div>
                    <div class="r-strength" id="rStrength">
                        <h4>Add Data</h4>
                        <p>Enter or generate data to see correlation</p>
                    </div>
                </div>
                
                <div class="card regression-box" style="flex-shrink: 0;">
                    <h4>üìê Regression Equation</h4>
                    <div class="equation" id="regEquation">y = ?</div>
                    <div class="regression-stats">
                        <div class="reg-stat">
                            <div class="label">Slope (b)</div>
                            <div class="value" id="slopeValue">-</div>
                        </div>
                        <div class="reg-stat">
                            <div class="label">Intercept (a)</div>
                            <div class="value" id="interceptValue">-</div>
                        </div>
                        <div class="reg-stat">
                            <div class="label">R¬≤</div>
                            <div class="value" id="rSquaredValue">-</div>
                        </div>
                        <div class="reg-stat">
                            <div class="label">Std Error</div>
                            <div class="value" id="stdErrorValue">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="card interpret-box" style="flex: 1;">
                    <h4>üìñ Interpreting Correlation</h4>
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 10px;">
                        The correlation coefficient (r) ranges from -1 to +1:
                    </div>
                    <div class="correlation-scale">
                        <div class="scale-item">
                            <span style="width: 80px;">¬±0.9 to ¬±1.0</span>
                            <div class="scale-bar"><div class="scale-fill very-strong"></div></div>
                            <span>Very Strong</span>
                        </div>
                        <div class="scale-item">
                            <span style="width: 80px;">¬±0.7 to ¬±0.9</span>
                            <div class="scale-bar"><div class="scale-fill strong"></div></div>
                            <span>Strong</span>
                        </div>
                        <div class="scale-item">
                            <span style="width: 80px;">¬±0.4 to ¬±0.7</span>
                            <div class="scale-bar"><div class="scale-fill moderate"></div></div>
                            <span>Moderate</span>
                        </div>
                        <div class="scale-item">
                            <span style="width: 80px;">¬±0.1 to ¬±0.4</span>
                            <div class="scale-bar"><div class="scale-fill weak"></div></div>
                            <span>Weak</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: var(--bg); border-radius: 8px; font-size: 0.75rem;">
                        <strong style="color: var(--teal);">‚ö†Ô∏è Important:</strong>
                        <p style="color: var(--text-muted); margin-top: 4px; line-height: 1.5;">
                            Correlation ‚â† Causation! A high r value doesn't mean X causes Y.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dataPoints = []; // Array of {height, weight}
        let scatterChart = null;
        let residualChart = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('weightInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addDataPoint();
            });
            updateDisplay();
        });
        
        function addDataPoint() {
            const heightInput = document.getElementById('heightInput');
            const weightInput = document.getElementById('weightInput');
            const height = parseFloat(heightInput.value);
            const weight = parseFloat(weightInput.value);
            
            if (isNaN(height) || height < 50 || height > 250) {
                alert('Please enter a valid height between 50 and 250 cm');
                return;
            }
            if (isNaN(weight) || weight < 20 || weight > 200) {
                alert('Please enter a valid weight between 20 and 200 kg');
                return;
            }
            
            dataPoints.push({ height, weight });
            heightInput.value = '';
            weightInput.value = '';
            heightInput.focus();
            updateDisplay();
        }
        
        function generateData(n, type) {
            for (let i = 0; i < n; i++) {
                const height = 140 + Math.random() * 50; // 140-190 cm
                let weight;
                
                switch(type) {
                    case 'strong':
                        weight = (height - 100) * 0.9 + randomNormal(0, 3);
                        break;
                    case 'weak':
                        weight = (height - 100) * 0.9 + randomNormal(0, 15);
                        break;
                    case 'negative':
                        weight = 120 - (height - 140) * 0.5 + randomNormal(0, 5);
                        break;
                    case 'none':
                        weight = 60 + Math.random() * 40;
                        break;
                }
                
                dataPoints.push({
                    height: Math.round(height * 10) / 10,
                    weight: Math.round(Math.max(40, weight) * 10) / 10
                });
            }
            updateDisplay();
        }
        
        function randomNormal(mean, std) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return mean + std * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }
        
        function removeDataPoint(index) {
            dataPoints.splice(index, 1);
            updateDisplay();
        }
        
        function clearAllData() {
            if (dataPoints.length === 0) return;
            if (confirm('Clear all data?')) {
                dataPoints = [];
                updateDisplay();
            }
        }
        
        function calculateCorrelation(data) {
            if (data.length < 2) return 0;
            
            const n = data.length;
            const sumX = data.reduce((sum, p) => sum + p.height, 0);
            const sumY = data.reduce((sum, p) => sum + p.weight, 0);
            const sumXY = data.reduce((sum, p) => sum + p.height * p.weight, 0);
            const sumX2 = data.reduce((sum, p) => sum + p.height * p.height, 0);
            const sumY2 = data.reduce((sum, p) => sum + p.weight * p.weight, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }
        
        function calculateRegression(data) {
            if (data.length < 2) return { slope: 0, intercept: 0 };
            
            const n = data.length;
            const sumX = data.reduce((sum, p) => sum + p.height, 0);
            const sumY = data.reduce((sum, p) => sum + p.weight, 0);
            const sumXY = data.reduce((sum, p) => sum + p.height * p.weight, 0);
            const sumX2 = data.reduce((sum, p) => sum + p.height * p.height, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            return { slope, intercept };
        }
        
        function calculateR2(data, regression) {
            if (data.length < 2) return 0;
            
            const meanY = data.reduce((sum, p) => sum + p.weight, 0) / data.length;
            const ssTotal = data.reduce((sum, p) => sum + Math.pow(p.weight - meanY, 2), 0);
            const ssResidual = data.reduce((sum, p) => {
                const predicted = regression.slope * p.height + regression.intercept;
                return sum + Math.pow(p.weight - predicted, 2);
            }, 0);
            
            return 1 - (ssResidual / ssTotal);
        }
        
        function calculateStdError(data, regression) {
            if (data.length < 3) return 0;
            
            const residuals = data.map(p => {
                const predicted = regression.slope * p.height + regression.intercept;
                return p.weight - predicted;
            });
            
            const mse = residuals.reduce((sum, r) => sum + r * r, 0) / (data.length - 2);
            return Math.sqrt(mse);
        }
        
        function updateDisplay() {
            updateDataTable();
            updateCorrelation();
            updateScatterPlot();
            updateResidualPlot();
        }
        
        function updateDataTable() {
            const table = document.getElementById('dataTable');
            document.getElementById('countValue').textContent = dataPoints.length;
            
            if (dataPoints.length === 0) {
                table.innerHTML = `<div class="empty-state"><div style="font-size: 2rem; opacity: 0.5; margin-bottom: 8px;">üì≠</div><p>Add height and weight pairs</p></div>`;
                return;
            }
            
            let html = `<table><thead><tr><th>#</th><th>Height (cm)</th><th>Weight (kg)</th><th></th></tr></thead><tbody>`;
            dataPoints.forEach((p, i) => {
                html += `<tr><td>${i+1}</td><td>${p.height.toFixed(1)}</td><td>${p.weight.toFixed(1)}</td><td><span class="remove-btn" onclick="removeDataPoint(${i})">√ó</span></td></tr>`;
            });
            html += '</tbody></table>';
            table.innerHTML = html;
        }
        
        function updateCorrelation() {
            if (dataPoints.length < 2) {
                document.getElementById('rValue').textContent = '-';
                document.getElementById('rStrength').innerHTML = '<h4>Add Data</h4><p>Enter or generate data to see correlation</p>';
                document.getElementById('regEquation').textContent = 'y = ?';
                ['slopeValue', 'interceptValue', 'rSquaredValue', 'stdErrorValue'].forEach(id => document.getElementById(id).textContent = '-');
                return;
            }
            
            const r = calculateCorrelation(dataPoints);
            const regression = calculateRegression(dataPoints);
            const r2 = calculateR2(dataPoints, regression);
            const stdError = calculateStdError(dataPoints, regression);
            
            document.getElementById('rValue').textContent = r.toFixed(3);
            document.getElementById('slopeValue').textContent = regression.slope.toFixed(3);
            document.getElementById('interceptValue').textContent = regression.intercept.toFixed(2);
            document.getElementById('rSquaredValue').textContent = r2.toFixed(3);
            document.getElementById('stdErrorValue').textContent = stdError.toFixed(2);
            document.getElementById('regEquation').textContent = `Weight = ${regression.slope.toFixed(2)} √ó Height + ${regression.intercept.toFixed(1)}`;
            
            // Update strength description
            const absR = Math.abs(r);
            let strength, direction, color;
            
            if (absR >= 0.9) strength = 'Very Strong';
            else if (absR >= 0.7) strength = 'Strong';
            else if (absR >= 0.4) strength = 'Moderate';
            else if (absR >= 0.1) strength = 'Weak';
            else strength = 'No';
            
            direction = r > 0 ? 'Positive' : 'Negative';
            color = absR > 0.7 ? 'var(--success)' : absR > 0.4 ? 'var(--teal)' : 'var(--warning)';
            
            document.getElementById('rStrength').innerHTML = `
                <h4 style="color: ${color};">${strength} ${direction} Correlation</h4>
                <p>R¬≤ = ${r2.toFixed(3)}: ${(r2 * 100).toFixed(1)}% of weight variation explained by height</p>
            `;
        }
        
        function updateScatterPlot() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            if (scatterChart) scatterChart.destroy();
            
            if (dataPoints.length === 0) {
                scatterChart = new Chart(ctx, { type: 'scatter', data: { datasets: [] }, options: { responsive: true, maintainAspectRatio: false } });
                return;
            }
            
            const regression = calculateRegression(dataPoints);
            const minX = Math.min(...dataPoints.map(p => p.height));
            const maxX = Math.max(...dataPoints.map(p => p.height));
            
            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Data Points',
                            data: dataPoints.map(p => ({ x: p.height, y: p.weight })),
                            backgroundColor: 'rgba(20, 184, 166, 0.8)',
                            borderColor: '#14b8a6',
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Regression Line',
                            data: [
                                { x: minX, y: regression.slope * minX + regression.intercept },
                                { x: maxX, y: regression.slope * maxX + regression.intercept }
                            ],
                            type: 'line',
                            borderColor: 'rgba(244, 63, 94, 0.8)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, labels: { color: '#94a3b8' } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Height (cm)', color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            title: { display: true, text: 'Weight (kg)', color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        function updateResidualPlot() {
            const ctx = document.getElementById('residualChart').getContext('2d');
            if (residualChart) residualChart.destroy();
            
            if (dataPoints.length < 2) {
                residualChart = new Chart(ctx, { type: 'scatter', data: { datasets: [] }, options: { responsive: true, maintainAspectRatio: false } });
                return;
            }
            
            const regression = calculateRegression(dataPoints);
            const residuals = dataPoints.map(p => ({
                x: p.height,
                y: p.weight - (regression.slope * p.height + regression.intercept)
            }));
            
            residualChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Residuals',
                        data: residuals,
                        backgroundColor: 'rgba(6, 182, 212, 0.8)',
                        borderColor: '#06b6d4',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            title: { display: true, text: 'Height (cm)', color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            title: { display: true, text: 'Residual', color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        // Info Panel Toggle
        function toggleInfoPanel() {
            const panel = document.getElementById('infoPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('open');
        }
        
        // Close panel when clicking overlay
        document.getElementById('overlay').addEventListener('click', toggleInfoPanel);
    </script>
    
    <!-- Info Panel Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-panel-header">
            <h2>üìö Understanding Correlation & Regression</h2>
            <button class="close-panel" onclick="toggleInfoPanel()">&times;</button>
        </div>
        
        <div class="info-section">
            <h3>üîó What is Correlation?</h3>
            <p><strong>Correlation</strong> measures the strength and direction of a linear relationship between two variables.</p>
            <div class="formula-box">Pearson's r ranges from -1 to +1</div>
            <p><strong>Interpretation:</strong></p>
            <ul>
                <li>+1: Perfect positive (as X increases, Y increases)</li>
                <li>0: No linear relationship</li>
                <li>-1: Perfect negative (as X increases, Y decreases)</li>
            </ul>
        </div>
        
        <div class="info-section">
            <h3>üìä R-Squared (R¬≤)</h3>
            <p><strong>R¬≤</strong> (coefficient of determination) tells you the proportion of variance in Y that's explained by X.</p>
            <div class="formula-box">R¬≤ = r¬≤ (correlation squared)</div>
            <p><strong>Example:</strong> If r = 0.8, then R¬≤ = 0.64. This means 64% of Y's variation is explained by X. The remaining 36% is due to other factors.</p>
        </div>
        
        <div class="info-section">
            <h3>üìê Regression Equation</h3>
            <p>The regression line predicts Y based on X:</p>
            <div class="formula-box">Y = bX + a</div>
            <p>Where:</p>
            <ul>
                <li><strong>b (slope):</strong> Change in Y for each 1-unit change in X</li>
                <li><strong>a (intercept):</strong> Value of Y when X = 0 (often not meaningful)</li>
            </ul>
        </div>
        
        <div class="info-section">
            <h3>üéØ Residual Analysis</h3>
            <p><strong>Residuals</strong> are the differences between actual and predicted values. They help assess model fit:</p>
            <ul>
                <li><strong>Random scatter:</strong> Good model fit</li>
                <li><strong>Pattern (curve):</strong> Relationship isn't linear</li>
                <li><strong>Fan shape:</strong> Variance changes with X</li>
                <li><strong>Outliers:</strong> Points that don't fit the pattern</li>
            </ul>
        </div>
        
        <div class="info-section">
            <h3>‚ö†Ô∏è CORRELATION ‚â† CAUSATION</h3>
            <p><strong>This is the most important concept!</strong> A high correlation does NOT mean X causes Y.</p>
            <div class="formula-box">Association ‚â† Causation</div>
            <p><strong>Spurious correlations:</strong></p>
            <ul>
                <li>Ice cream sales ‚Üî Drowning deaths (confound: temperature)</li>
                <li>Pirates ‚Üî Global warming (coincidence)</li>
                <li>Storks ‚Üî Birth rate (confound: rural areas)</li>
            </ul>
            <p><strong>Three criteria for causation:</strong> Association, temporal precedence, no confounding.</p>
        </div>
        
        <div class="info-section">
            <h3>üåç Geography Examples</h3>
            <ul>
                <li><strong>Elevation vs Temperature:</strong> Negative correlation</li>
                <li><strong>Distance from city center vs Housing price:</strong> Negative correlation</li>
                <li><strong>Income vs Health outcomes:</strong> Positive correlation</li>
            </ul>
        </div>
        
        <div class="info-section">
            <h3>üí° Best Practices</h3>
            <ul>
                <li>Always visualize with scatter plots</li>
                <li>Check residuals for model fit</li>
                <li>Report R¬≤, not just r</li>
                <li>Never infer causation from correlation alone</li>
                <li>Consider outliers' influence</li>
            </ul>
        </div>
    </div>
</body>
</html>
